import streamlit as st
import datetime

# ==============================
# ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹: è¥¿æ–°äº•é§…å‰ â†’ æ± è¢‹é§…æ±å£ï¼‰
# å®Ÿéš›ã®æ™‚åˆ»è¡¨ã‚’å…¥ã‚Œæ›¿ãˆå¯èƒ½
# ==============================
bus_stops = [
    "è¥¿æ–°äº•é§…å‰", "æœ¬æœ¨æ–°é“", "ç†Šé‡å‰", "ç‹å­é§…å‰", "æ± è¢‹é§…æ±å£"
]

# ç°¡å˜ãªæ™‚åˆ»è¡¨ãƒ‡ãƒ¼ã‚¿ï¼ˆå¹³æ—¥ãƒ€ã‚¤ãƒ¤ä¾‹ï¼‰
# key: å‡ºç™ºåœ°, value: å‡ºç™ºæ™‚åˆ»ã®ãƒªã‚¹ãƒˆ
# æœ¬ç•ªã§ã¯ã‚‚ã£ã¨è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹ã¨ã‚ˆã„
timetable = {
    "è¥¿æ–°äº•é§…å‰": ["07:00", "07:30", "08:00", "08:30", "09:00", "10:00"],
    "æœ¬æœ¨æ–°é“":   ["07:10", "07:40", "08:10", "08:40", "09:10", "10:10"],
    "ç†Šé‡å‰":     ["07:20", "07:50", "08:20", "08:50", "09:20", "10:20"],
    "ç‹å­é§…å‰":   ["07:35", "08:05", "08:35", "09:05", "09:35", "10:35"],
    "æ± è¢‹é§…æ±å£": ["07:55", "08:25", "08:55", "09:25", "09:55", "10:55"],
}

# ==============================
# Streamlit ã‚¢ãƒ—ãƒªæœ¬ä½“
# ==============================
st.set_page_config(page_title="ãƒã‚¹æ™‚åˆ»æ¤œç´¢", page_icon="ğŸšŒ", layout="centered")

st.title("ğŸšŒ ãƒã‚¹æ™‚åˆ»æ¤œç´¢ã‚¢ãƒ—ãƒª")
st.write("è¥¿æ–°äº•é§…å‰ â†’ æ± è¢‹é§…æ±å£ ã®ãƒã‚¹æ™‚åˆ»ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚")

# å‡ºç™ºåœç•™æ‰€ & åˆ°ç€åœç•™æ‰€
departure = st.selectbox("å‡ºç™ºåœç•™æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„", bus_stops, index=0)
arrival = st.selectbox("åˆ°ç€åœç•™æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„", bus_stops, index=len(bus_stops)-1)

# å‡ºç™ºå¸Œæœ›æ™‚åˆ»
selected_time = st.time_input("å‡ºç™ºå¸Œæœ›æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", datetime.time(7, 0))

# æ¤œç´¢ãƒœã‚¿ãƒ³
if st.button("æ¤œç´¢"):
    # å‡ºç™ºåœç•™æ‰€ã®æ™‚åˆ»è¡¨ã‚’å–å¾—
    times = timetable.get(departure, [])

    # å…¥åŠ›æ™‚åˆ»ä»¥é™ã®ä¾¿ã‚’æ¤œç´¢
    target = None
    for t in times:
        hh, mm = map(int, t.split(":"))
        if datetime.time(hh, mm) >= selected_time:
            target = t
            break

    if target:
        st.success(f"âœ… {departure} ç™º {target} ã®ä¾¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼")

        # å…¨åœç•™æ‰€ã®æ™‚åˆ»ã‚’ä¸€è¦§è¡¨ç¤º
        st.write("### ã“ã®ä¾¿ã®åœè»Šé§…ã¨æ™‚åˆ»")
        for stop in bus_stops:
            idx = timetable[departure].index(target)
            stop_time = timetable[stop][idx]
            st.write(f"- {stop} : {stop_time}")
    else:
        st.error("è©²å½“ã™ã‚‹ä¾¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
