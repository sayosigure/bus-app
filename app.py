import streamlit as st
import datetime

st.set_page_config(page_title="バス時刻検索", page_icon="🚌")

st.title("🚌 王40甲系統 時刻検索（平日サンプル）")
st.write("西新井駅前 → 王子駅前 → 池袋駅東口 の平日ダイヤを検索できます。")

# 停留所リスト
bus_stops = ["西新井駅前", "王子駅前", "池袋駅東口"]

# 平日ダイヤ（実データを参考にしたサンプル）
timetable = {
    "西新井駅前": [
        "06:20", "06:26", "06:32", "06:38", "06:44", "06:50",
        "06:55", "07:00", "07:04", "07:08", "07:12", "07:16",
        "07:20", "07:24", "07:28", "07:32", "07:36", "07:40",
        "07:44", "07:49", "07:54", "07:59", "08:04", "08:09",
        "08:15", "08:21", "08:27", "08:33", "08:40", "08:46",
        "08:52", "08:58", "09:05", "09:11", "09:18", "09:25",
        "09:31", "09:38", "09:45", "09:52", "09:59", "10:06",
        "10:12", "10:18", "10:25", "10:32", "10:39", "10:46", "10:53"
    ],
    "王子駅前": [
        "06:36", "06:46", "06:50", "07:02", "07:13", "07:21",
        "07:28", "07:36", "07:43", "07:50", "07:56", "08:02",
        "08:08", "08:14", "08:20", "08:26", "08:32", "08:39",
        "08:45", "08:51", "08:57", "09:03", "09:09", "09:15",
        "09:21", "09:27", "09:33", "09:39", "09:45", "09:51",
        "09:57", "10:02", "10:08", "10:14", "10:20", "10:26",
        "10:32", "10:38", "10:44", "10:50", "10:56", "11:02",
        "11:08", "11:14", "11:20", "11:26", "11:32", "11:38", "11:44"
    ],
    "池袋駅東口": [
        "06:41", "06:51", "06:59", "07:07", "07:17", "07:21",
        "07:23", "07:30", "07:31", "07:38", "07:43", "07:51",
        "07:54", "08:02", "08:05", "08:12", "08:15", "08:23",
        "08:27", "08:34", "08:37", "08:45", "08:49", "08:57",
        "09:01", "09:09", "09:13", "09:21", "09:28", "09:35",
        "09:43", "09:50", "09:58", "10:06", "10:13", "10:21",
        "10:29", "10:36", "10:44", "10:52", "10:59", "11:07",
        "11:14", "11:22", "11:30", "11:37", "11:45", "11:53", "12:00"
    ]
}

# 出発地と到着地の選択
departure = st.selectbox("出発停留所を選択", bus_stops, index=0)
arrival = st.selectbox("到着停留所を選択", bus_stops, index=2)
selected_time = st.time_input("出発希望時刻", datetime.time(6, 20))

if st.button("検索"):
    dep_list = timetable.get(departure, [])
    idx = None
    for i, t in enumerate(dep_list):
        hh, mm = map(int, t.split(":"))
        if datetime.time(hh, mm) >= selected_time:
            idx = i
            break

    if idx is not None:
        dep = timetable[departure][idx]
        arr = timetable[arrival][idx] if len(timetable[arrival]) > idx else "－"
        st.success(f"{departure} 発 {dep} → {arrival} 着 {arr}")

        st.write("### 停留所ごとの通過時刻")
        for stop in bus_stops:
            t = timetable[stop][idx] if len(timetable[stop]) > idx else "－"
            st.write(f"- {stop}: {t}")
    else:
        st.error("該当する便はありませんでした。")
